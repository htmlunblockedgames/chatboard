<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Chatboard</title>
  <script src="https://cdn.jsdelivr.net/npm/twikoo@1/dist/twikoo.all.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background:#f8f8f8; padding:20px; }
    #tcomment { max-width: 800px; margin:auto; background:#fff; padding:20px; border-radius:8px; }
  </style>
</head>
<body>
  <h1>Chatboard</h1>
  <div id="tcomment"></div>

  <script>
    // Replace this with your deployed Cloudflare Worker URL
    const WORKER_URL = "https://twikoo-cloudflare.ertertertet07.workers.dev";

    // Patch Twikoo's uploadImage to use your Worker (which forwards to ImgBB)
    window.twikooUploadImage = async (file) => {
      const reader = new FileReader();
      return new Promise((resolve, reject) => {
        reader.onload = async () => {
          try {
            const res = await fetch(WORKER_URL, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                event: "UPLOAD_IMAGE",
                photo: reader.result
              })
            });
            const json = await res.json();
            if (json.code === 0) {
              resolve(json.data.url); // Twikoo expects URL string
            } else {
              reject(new Error(json.err || "Upload failed"));
            }
          } catch (e) {
            reject(e);
          }
        };
        reader.readAsDataURL(file);
      });
    };

    // Initialize Twikoo
    twikoo.init({
      el: "#tcomment",
      envId: WORKER_URL, // your Worker URL
      lang: "en"
    });
  </script>
</body>
</html>
