<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Poly Track Chatboard</title>
  <style>
    /* ===== Site Palette ===== */
    :root{
      --bg:#fafafa; --panel:#ffffff; --panel-2:#f5f5f5;
      --border:#dadce0; --border-2:#e0e0e0;
      --text:#1f2125; --muted:#5f6369;
      --accent:#2694d5; --accent-2:#0280ca;
      --ok:#0f9d58; --danger:#d93025;
      --radius:16px; --inner:18px;
      --shadow:0 8px 18px rgba(0,0,0,.05);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      font-weight:600; color:var(--text); background:var(--bg);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      letter-spacing:.1px;
    }

    /* Header */
    header{
      padding:18px 16px; border-bottom:1px solid var(--border);
      display:flex; align-items:center; justify-content:space-between;
      background:linear-gradient(180deg,#ffffff,#fbfbfb);
    }
    header h1{margin:0;font-size:20px;font-weight:800}
    .status{
      font-size:12px; padding:6px 12px; border:1px solid var(--border);
      border-radius:999px; background:#fefefe; color:var(--muted);
    }
    .status.ok{color:#0b7d3b;border-color:#cfe8da;background:#f6fff9}
    .status.bad{color:#b3261e;border-color:#f1c9c6;background:#fff6f5}

    /* Layout */
    .container{max-width:920px;margin:0 auto;padding:20px;display:grid;gap:18px}
    .panel{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow)}

    /* Admin panel */
    #adminPanel{padding:18px;display:none;gap:10px}
    #adminPanel .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    #adminNote{font-size:12px;color:var(--muted)}
    .admin-actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
    .tag{font-size:11px;border:1px solid var(--border-2);border-radius:999px;padding:3px 8px;color:var(--muted);background:#f9fafb}

    /* Composer */
    #composer{padding:18px;display:grid;gap:12px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .row-slim{gap:8px}
    input[type="text"], textarea{
      width:100%; padding:12px 14px; border-radius:12px; border:1px solid var(--border);
      background:var(--panel-2); color:var(--text); outline:none;
      transition:border-color .15s, box-shadow .15s, background .2s;
      font-size:14px; font-weight:600;
    }
    input[type="text"]:focus, textarea:focus{
      border-color:var(--accent); box-shadow:0 0 0 3px #2694d522; background:#fff;
    }
    textarea{min-height:120px; resize:vertical; line-height:1.58}

    /* Buttons – unified size & font */
    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      padding:10px 14px; border-radius:12px; border:1px solid var(--border);
      background:#eaf5fc; color:#0f3c55; cursor:pointer;
      transition:transform .05s ease, background .15s, border-color .15s, color .15s;
      font-weight:700; font-size:14px; line-height:1; min-width:140px; height:40px;
      text-align:center; user-select:none;
    }
    .btn:hover{background:#dff0fb;border-color:#cfe8f8}
    .btn:active{transform:translateY(1px)}
    .btn.primary{
      background:linear-gradient(180deg,var(--accent),var(--accent-2));
      border-color:#197fb4; color:#fff;
    }
    .btn.primary:hover{filter:brightness(1.03)}
    .btn:disabled{opacity:.6;cursor:not-allowed}

    /* Custom file input */
    #file{display:none}
    .file-btn{display:inline-flex}
    .file-name{font-size:12px;color:var(--muted)}

    /* Inline status */
    #status{display:none;font-size:12px;color:var(--muted)}

    /* Reply pill */
    #replyTo{
      display:none; font-size:12px; color:var(--muted);
      background:#f9f9f9; border:1px solid var(--border-2); padding:6px 10px;
      border-radius:999px;
    }
    #replyCancel{margin-left:8px;color:var(--accent);cursor:pointer;font-weight:800}

    /* Messages */
    #messages{padding:14px var(--inner);display:flex;flex-direction:column;gap:14px;min-height:36vh}
    .msg{
      display:flex; gap:12px; padding:12px 14px; border:1px solid var(--border);
      border-radius:14px; background:#fff;
    }
    .avatar{
      width:40px; height:40px; border-radius:50%;
      background:#b3c1fe22; display:flex; align-items:center; justify-content:center;
      font-weight:900; color:#1f2127; flex:0 0 40px; overflow:hidden; border:1px solid #b3c1fe66;
    }
    .avatar img{width:100%;height:100%;object-fit:cover}
    .bubble{flex:1;min-width:0}
    .meta{font-size:12px;color:var(--muted);display:flex;gap:10px;align-items:center}
    .nick{color:#1f2127;font-weight:800}
    .content{margin-top:6px;line-height:1.58;word-wrap:break-word}
    .content img{max-width:480px;border-radius:10px;border:1px solid var(--border);display:block;margin:8px 0;background:#fafafa}

    /* Actions */
    .actions{display:flex;gap:14px;align-items:center;margin-top:8px;flex-wrap:wrap}
    .action{
      font-size:12px;color:var(--accent);cursor:pointer;font-weight:800;
      background:#fdfdfd;border:1px solid var(--border-2);padding:6px 10px;border-radius:999px;
      user-select:none;
    }
    .action:hover{background:#f8f8f8}

    /* Replies container under each top-level */
    .replies{display:none; margin-top:10px; padding-left:0; display:flex; flex-direction:column; gap:10px}

    /* Load older – full bubble width */
    #loadMore{
      display:none; margin:8px var(--inner) 18px;
      width:calc(100% - var(--inner)*2);
    }

    .limits{font-size:12px;color:var(--muted)}
    a{color:var(--accent)}
  </style>
</head>
<body>
  <header>
    <h1>Poly Track Chatboard</h1>
    <div id="conn" class="status">Status: checking…</div>
  </header>

  <main class="container">
    <!-- Admin Panel (hidden; open via #admin or ?admin=1) -->
    <section id="adminPanel" class="panel">
      <div class="row">
        <strong>Admin</strong>
        <span id="adminNote" class="tag">Login to manage comments</span>
      </div>
      <div class="row" id="adminLoginRow">
        <input id="adminPass" type="password" placeholder="Admin password"/>
        <button id="btnAdminLogin" class="btn">Login</button>
      </div>
      <div class="row" id="adminControls" style="display:none">
        <span class="tag">Pinned: <span id="pinCount">0</span> / 3</span>
        <button id="btnAdminLogout" class="btn">Logout</button>
      </div>
    </section>

    <!-- Composer -->
    <section id="composer" class="panel">
      <div class="row">
        <input id="nick" type="text" placeholder="Nickname (optional, default Anonymous)"/>
      </div>

      <div id="replyTo" class="row">
        Replying to <strong id="replyName"></strong><span id="replyCancel" title="Cancel reply">✕</span>
      </div>

      <div class="row">
        <textarea id="text" placeholder="Type your message… You can also attach an image."></textarea>
      </div>

      <div class="row row-slim">
        <label for="file" class="btn file-btn" id="btnChoose">Choose image</label>
        <input id="file" type="file" accept="image/*"/>
        <span id="fileInfo" class="file-name"></span>
        <button id="btnAttach" class="btn">Attach image</button>
        <div style="margin-left:auto">
          <button id="btnSend" class="btn primary">Send</button>
        </div>
      </div>

      <div class="row row-slim" style="margin-top:-2px">
        <span class="limits">
          Images: PNG/JPG/GIF/WebP ≤ <span id="limitMb">5</span> MB · Message limit: <span id="limitChars">2000</span> chars ·
          <span id="charCount">0</span>/<span id="limitChars2">2000</span>
        </span>
        <span id="status" style="margin-left:auto"></span>
      </div>
    </section>

    <!-- Messages -->
    <section class="panel">
      <div id="messages"></div>
      <button id="loadMore" class="btn primary">Load older</button>
    </section>
  </main>

  <!-- Load the external script (no inline duplication) -->
  <script src="index.js?v=7"></script>
</body>
</html>