<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Twikoo on Cloudflare Worker (Demo)</title>
  <style>
    :root { color-scheme: light dark; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    header { padding: 1rem 1.25rem; border-bottom: 1px solid #ddd; }
    main { max-width: 880px; margin: 0 auto; padding: 1rem; }
    .tip { font-size: 0.9rem; opacity: .8; margin-bottom: 1rem; }
    .ok { color: #2e7d32; }
    .err { color: #c62828; }
    code { padding: .15rem .35rem; background: rgba(127,127,127,.12); border-radius: 6px; }
  </style>
</head>
<body>
  <header>
    <strong>Twikoo Demo</strong>
  </header>

  <main>
    <p class="tip">
      This page mounts Twikoo comments served by your Cloudflare Worker.
      Make sure your Workerâ€™s CORS allows this origin.
    </p>

    <!-- Twikoo container -->
    <div id="tcomment"></div>

    <p id="status" class="tip"></p>
  </main>

  <!-- Twikoo (frontend) -->
  <script src="https://cdn.jsdelivr.net/npm/twikoo@1.6.40/dist/twikoo.all.min.js"></script>

  <!-- If you enabled Cloudflare Turnstile in Twikoo config, uncomment and set your sitekey
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
  -->

  <script>
    // ==== EDIT THESE TWO LINES ====
    const WORKER_URL = 'https://twikoo-cloudflare.ertertertet07.workers.dev'; // your Worker endpoint
    const PAGE_URL   = location.pathname; // use a stable identifier per page (or set manually)
    // ==============================

    const statusEl = document.getElementById('status');

    // Basic health check (optional)
    fetch(WORKER_URL, { method: 'GET' })
      .then(r => r.json())
      .then(j => statusEl.innerHTML =
        `<span class="ok">Worker online.</span> Version: <code>${j.version || 'unknown'}</code>`)
      .catch(() => statusEl.innerHTML =
        `<span class="err">Could not reach Worker. Check URL & CORS.</span>`);

    // Initialize Twikoo
    twikoo.init({
      envId: WORKER_URL,          // Cloudflare Worker URL
      el:    '#tcomment',
      lang:  'en',
      // The page identity (Twikoo uses url to group comments)
      path:  PAGE_URL,
      // If you configured an external image host in Twikoo DB config (e.g., imgbb / sm.ms),
      // turn this on to allow uploads from the editor:
      uploadImages: { enabled: true },
      // If you enabled Turnstile in Twikoo DB config, you can pass the sitekey here:
      // captcha: { provider: 'turnstile', siteKey: 'YOUR_TURNSTILE_SITE_KEY' }
    });

    // Helpful console hints
    console.log('[Twikoo] Using Worker:', WORKER_URL);
    console.log('[Twikoo] Page path:', PAGE_URL);
    console.log('[Twikoo] Ensure your Worker DB config has UPLOAD_IMG_TYPE + key/token set if using uploads.');
    console.log('[Twikoo] Ensure CORS_ALLOW_ORIGIN in Twikoo config includes this page origin:', location.origin);
  </script>
</body>
</html>
